# オートウェビナー配信プラットフォーム 開発ロードマップ

| 項目 | 内容 |
|------|------|
| 文書ID | AW-ROADMAP-20251205 |
| バージョン | 1.0 |
| 作成日 | 2025年12月5日 |
| 基準文書 | 要件定義書 AW-REQ-20251205 v1.0 |

---

## 全体概要

### ゴール
フロントエンドUIで操作して、動画（YouTube URL）の設定や日時設定を行い、指定した日時にウェブサイト上で擬似ライブウェビナーが配信される状態を完成させる。

### 開発フェーズ構成

```
Phase 0: 環境構築・基盤整備
    ↓
Phase 1: コアエンジン開発（視聴者向けプレイヤー）
    ↓
Phase 2: 管理画面・データベース連携
    ↓
Phase 3: 埋め込み機能・外部連携
    ↓
Phase 4: UI/UX磨き込み・テスト
    ↓
Phase 5: 本番デプロイ・運用開始
```

---

## Phase 0: 環境構築・基盤整備

### 目的
開発に必要な環境とプロジェクト基盤を整備する。

---

### Step 0-1: 開発環境セットアップ

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 0-1-1 | Node.js確認 | Node.js 18以上がインストールされていることを確認 | - |
| 0-1-2 | パッケージマネージャー | pnpm または npm の選定・設定 | - |
| 0-1-3 | エディタ設定 | VSCode拡張機能（ESLint, Prettier, Tailwind CSS IntelliSense） | .vscode/extensions.json |
| 0-1-4 | Git初期化 | リポジトリ初期化、.gitignore設定 | .gitignore |

#### 実行コマンド例
```bash
# Node.jsバージョン確認
node -v

# Git初期化
git init
```

---

### Step 0-2: Next.jsプロジェクト作成

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 0-2-1 | Next.js初期化 | App Router + TypeScript + Tailwind CSS | プロジェクト構造 |
| 0-2-2 | ESLint/Prettier設定 | コードスタイル統一 | .eslintrc.json, .prettierrc |
| 0-2-3 | ディレクトリ構成 | 機能別ディレクトリ設計 | src/ 以下の構造 |
| 0-2-4 | 基本コンポーネントライブラリ | shadcn/ui インストール | components/ui/ |

#### 実行コマンド例
```bash
# Next.jsプロジェクト作成
npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir

# shadcn/ui初期化
npx shadcn-ui@latest init
npx shadcn-ui@latest add button card input label
```

#### ディレクトリ構成（目標）
```
src/
├── app/                    # App Router
│   ├── (auth)/            # 認証関連ページ
│   │   ├── login/
│   │   └── admin-login/
│   ├── (dashboard)/       # 管理画面
│   │   ├── dashboard/
│   │   ├── webinars/
│   │   └── admin/
│   ├── watch/[id]/        # 視聴ページ
│   ├── embed/[id]/        # 埋め込みページ
│   ├── api/               # API Routes
│   └── layout.tsx
├── components/
│   ├── ui/                # shadcn/ui コンポーネント
│   ├── player/            # 動画プレイヤー関連
│   ├── dashboard/         # 管理画面関連
│   └── common/            # 共通コンポーネント
├── lib/
│   ├── firebase/          # Firebase設定・ユーティリティ
│   ├── youtube/           # YouTube API関連
│   └── utils.ts           # 汎用ユーティリティ
├── hooks/                 # カスタムフック
├── types/                 # TypeScript型定義
└── styles/                # グローバルスタイル
```

---

### Step 0-3: Firebase プロジェクト設定

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 0-3-1 | Firebaseプロジェクト作成 | Firebase Consoleで新規プロジェクト作成 | Firebase Project |
| 0-3-2 | Authentication有効化 | メール/パスワード認証を有効化 | - |
| 0-3-3 | Firestore有効化 | Cloud Firestoreをプロビジョニング | - |
| 0-3-4 | Firebase SDK設定 | Next.jsにFirebase SDKをインストール・設定 | lib/firebase/config.ts |
| 0-3-5 | 環境変数設定 | Firebase認証情報を環境変数に設定 | .env.local |
| 0-3-6 | Firestore Rules作成 | 初期セキュリティルール設定 | firestore.rules |

#### Firebase設定ファイル例
```typescript
// src/lib/firebase/config.ts
import { initializeApp, getApps } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

const app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];
export const auth = getAuth(app);
export const db = getFirestore(app);
```

#### 環境変数（.env.local）
```
NEXT_PUBLIC_FIREBASE_API_KEY=xxxxx
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=xxxxx.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=xxxxx
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=xxxxx.appspot.com
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=xxxxx
NEXT_PUBLIC_FIREBASE_APP_ID=xxxxx

# YouTube Data API (サーバーサイド用)
YOUTUBE_API_KEY=xxxxx
```

---

### Step 0-4: Vercel プロジェクト設定

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 0-4-1 | Vercelアカウント確認 | アカウント作成済みか確認 | - |
| 0-4-2 | GitHubリポジトリ作成 | リモートリポジトリ作成・プッシュ | GitHub Repository |
| 0-4-3 | Vercel連携 | GitHubリポジトリをVercelに接続 | Vercel Project |
| 0-4-4 | 環境変数設定 | Vercelに環境変数を登録 | - |
| 0-4-5 | 動作確認 | 初期デプロイ・動作確認 | デプロイ済みURL |

---

### Phase 0 完了チェックリスト

- [ ] Next.jsプロジェクトがローカルで起動する (`npm run dev`)
- [ ] Firebaseプロジェクトが作成されている
- [ ] Firebase SDKがNext.jsに組み込まれている
- [ ] Vercelにデプロイされ、アクセス可能である
- [ ] 環境変数が正しく設定されている

---

## Phase 1: コアエンジン開発（視聴者向けプレイヤー）

### 目的
擬似ライブ配信の核となる動画プレイヤーを実装する。

---

### Step 1-1: サーバー時刻取得機能

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-1-1 | 時刻取得API作成 | サーバー時刻を返すAPI Route | src/app/api/server-time/route.ts |
| 1-1-2 | 時刻取得フック作成 | クライアントから時刻を取得するフック | src/hooks/useServerTime.ts |
| 1-1-3 | dayjs設定 | タイムゾーン処理（JST固定） | src/lib/dayjs.ts |

#### API実装例
```typescript
// src/app/api/server-time/route.ts
import { NextResponse } from 'next/server';

export async function GET() {
  return NextResponse.json({
    serverTime: new Date().toISOString(),
    timestamp: Date.now(),
  });
}
```

---

### Step 1-2: 状態遷移ロジック実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-2-1 | 状態定義 | BEFORE/ON_AIR/ENDED の型定義 | src/types/webinar.ts |
| 1-2-2 | 状態計算関数 | サーバー時刻から状態を計算 | src/lib/webinar-state.ts |
| 1-2-3 | 状態管理フック | 現在状態を監視・更新するフック | src/hooks/useWebinarState.ts |

#### 状態計算ロジック例
```typescript
// src/lib/webinar-state.ts
import dayjs from '@/lib/dayjs';

export type WebinarState = 'BEFORE' | 'ON_AIR' | 'ENDED';

export function calculateWebinarState(
  serverTime: Date,
  scheduleTime: string, // "HH:mm"
  durationSec: number
): { state: WebinarState; seekPosition?: number } {
  const now = dayjs(serverTime);
  const today = now.format('YYYY-MM-DD');
  const startTime = dayjs(`${today} ${scheduleTime}`, 'YYYY-MM-DD HH:mm');
  const endTime = startTime.add(durationSec, 'second');

  if (now.isBefore(startTime)) {
    return { state: 'BEFORE' };
  } else if (now.isBefore(endTime)) {
    const seekPosition = now.diff(startTime, 'second');
    return { state: 'ON_AIR', seekPosition };
  } else {
    return { state: 'ENDED' };
  }
}
```

---

### Step 1-3: YouTube IFrame Player実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-3-1 | YouTube IFrame API読み込み | Script読み込みコンポーネント | src/components/player/YouTubeScript.tsx |
| 1-3-2 | プレイヤーコンポーネント | YouTube Player Wrapper | src/components/player/YouTubePlayer.tsx |
| 1-3-3 | プレイヤー制御フック | 再生/停止/シーク制御 | src/hooks/useYouTubePlayer.ts |
| 1-3-4 | パラメータ設定 | controls=0, playsinline=1 等 | - |

#### プレイヤーコンポーネント例
```typescript
// src/components/player/YouTubePlayer.tsx
'use client';

import { useEffect, useRef } from 'react';

interface YouTubePlayerProps {
  videoId: string;
  onReady?: (player: YT.Player) => void;
  onStateChange?: (state: YT.PlayerState) => void;
}

export function YouTubePlayer({ videoId, onReady, onStateChange }: YouTubePlayerProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const playerRef = useRef<YT.Player | null>(null);

  useEffect(() => {
    if (!window.YT) return;

    playerRef.current = new window.YT.Player(containerRef.current!, {
      videoId,
      playerVars: {
        controls: 0,
        modestbranding: 1,
        rel: 0,
        playsinline: 1,
        disablekb: 1,
      },
      events: {
        onReady: (event) => onReady?.(event.target),
        onStateChange: (event) => onStateChange?.(event.data),
      },
    });

    return () => {
      playerRef.current?.destroy();
    };
  }, [videoId]);

  return <div ref={containerRef} className="w-full aspect-video" />;
}
```

---

### Step 1-4: 入場フロー実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-4-1 | 入場オーバーレイ | サムネイル + ぼかし + ボタン | src/components/player/EntryOverlay.tsx |
| 1-4-2 | パルスアニメーション | ボタンの注目アニメーション | Tailwind CSS |
| 1-4-3 | 入場処理 | ミュート解除 + シーク + 再生 | src/hooks/useEntryFlow.ts |
| 1-4-4 | 統合テスト | LINEブラウザでの動作確認 | - |

#### 入場オーバーレイ例
```typescript
// src/components/player/EntryOverlay.tsx
'use client';

interface EntryOverlayProps {
  thumbnailUrl: string;
  onEnter: () => void;
  countdown?: string;
}

export function EntryOverlay({ thumbnailUrl, onEnter, countdown }: EntryOverlayProps) {
  return (
    <div className="absolute inset-0 z-20 flex flex-col items-center justify-center">
      {/* ぼかし背景 */}
      <div
        className="absolute inset-0 bg-cover bg-center blur-md opacity-50"
        style={{ backgroundImage: `url(${thumbnailUrl})` }}
      />

      {/* コンテンツ */}
      <div className="relative z-10 text-center text-white">
        {countdown && (
          <div className="mb-8">
            <p className="text-lg">開催まで あと</p>
            <p className="text-4xl font-bold">{countdown}</p>
          </div>
        )}

        <button
          onClick={onEnter}
          className="px-8 py-4 bg-red-600 rounded-lg text-xl font-bold
                     animate-pulse hover:bg-red-700 transition-colors"
        >
          会場に入場する
        </button>
      </div>
    </div>
  );
}
```

---

### Step 1-5: プレイヤーUI（Click Block + LIVEバッジ）

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-5-1 | Click Blocker | 透明divでYouTubeクリックを防止 | src/components/player/ClickBlocker.tsx |
| 1-5-2 | LIVEバッジ | 左上の赤点滅バッジ | src/components/player/LiveBadge.tsx |
| 1-5-3 | プレイヤーレイアウト | 全レイヤー統合 | src/components/player/WebinarPlayer.tsx |

---

### Step 1-6: 終了画面実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-6-1 | 終了画面コンポーネント | 「配信終了」メッセージ表示 | src/components/player/EndScreen.tsx |
| 1-6-2 | 終了1秒前検知 | YouTube関連動画隠蔽のため | src/hooks/useEndDetection.ts |
| 1-6-3 | リダイレクト処理 | 設定URLへの自動遷移 | - |

---

### Step 1-7: 視聴ページ統合

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 1-7-1 | 視聴ページ作成 | 全コンポーネント統合 | src/app/watch/[id]/page.tsx |
| 1-7-2 | モックデータ対応 | Firestore未連携での動作確認 | - |
| 1-7-3 | レスポンシブ対応 | モバイル・デスクトップ対応 | - |

---

### Phase 1 完了チェックリスト

- [ ] サーバー時刻が取得できる
- [ ] BEFORE状態でカウントダウンが表示される
- [ ] ON_AIR状態で入場ボタンが表示される
- [ ] 入場ボタンタップで音声付き再生が開始される
- [ ] 途中参加時に正しい位置にシークされる
- [ ] YouTubeコントロールが隠蔽されている
- [ ] Click Blockerが機能している
- [ ] LIVEバッジが表示・点滅している
- [ ] 終了時に終了画面が表示される
- [ ] LINEブラウザ（iOS）で正常動作する
- [ ] LINEブラウザ（Android）で正常動作する

---

## Phase 2: 管理画面・データベース連携

### 目的
テナント管理者がウェビナーを作成・管理できるダッシュボードを実装する。

---

### Step 2-1: Firestoreスキーマ実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-1-1 | 型定義作成 | Tenant, Webinar の TypeScript型 | src/types/firestore.ts |
| 2-1-2 | Firestoreユーティリティ | CRUD操作のヘルパー関数 | src/lib/firebase/firestore.ts |
| 2-1-3 | Firestore Rules更新 | 本番用セキュリティルール | firestore.rules |

#### 型定義例
```typescript
// src/types/firestore.ts
import { Timestamp } from 'firebase/firestore';

export interface Tenant {
  uid: string;
  email: string;
  companyName: string;
  status: 'active' | 'suspended';
  createdAt: Timestamp;
}

export interface CTASettings {
  showTimeSec: number;
  label: string;
  url: string;
}

export interface Webinar {
  id: string;
  tenantId: string;
  title: string;
  youtubeId: string;
  durationSec: number;
  scheduleTime: string; // "HH:mm"
  ctaSettings?: CTASettings;
  loopProtection: boolean;
  embedAllowedDomains?: string[];
  thumbnailUrl?: string;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

---

### Step 2-2: 認証機能実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-2-1 | 認証コンテキスト | ログイン状態管理 | src/contexts/AuthContext.tsx |
| 2-2-2 | ログインページ | メール/パスワードフォーム | src/app/(auth)/login/page.tsx |
| 2-2-3 | 認証ガード | 未認証時リダイレクト | src/components/auth/AuthGuard.tsx |
| 2-2-4 | ログアウト機能 | セッション終了 | - |

---

### Step 2-3: ダッシュボード実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-3-1 | レイアウト作成 | サイドバー + メインコンテンツ | src/app/(dashboard)/layout.tsx |
| 2-3-2 | サイドバー | ナビゲーションメニュー | src/components/dashboard/Sidebar.tsx |
| 2-3-3 | ダッシュボードトップ | ウェビナー一覧表示 | src/app/(dashboard)/dashboard/page.tsx |
| 2-3-4 | ウェビナーカード | 一覧表示用カードコンポーネント | src/components/dashboard/WebinarCard.tsx |

---

### Step 2-4: ウェビナーCRUD実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-4-1 | 新規作成ページ | 入力フォーム | src/app/(dashboard)/webinars/new/page.tsx |
| 2-4-2 | 編集ページ | 既存データ編集 | src/app/(dashboard)/webinars/[id]/edit/page.tsx |
| 2-4-3 | 削除機能 | 確認ダイアログ + 削除 | - |
| 2-4-4 | フォームバリデーション | 入力値検証 | - |

#### ウェビナー作成フォーム項目
```
┌─────────────────────────────────────────────────────┐
│  ウェビナー新規作成                                   │
├─────────────────────────────────────────────────────┤
│  タイトル *                                          │
│  ┌─────────────────────────────────────────────┐   │
│  │                                             │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  YouTube URL *                                      │
│  ┌─────────────────────────────────────────────┐   │
│  │                                             │   │
│  └─────────────────────────────────────────────┘   │
│  [動画情報を取得]                                    │
│                                                     │
│  動画の長さ: 00:45:30 (自動取得)                      │
│  サムネイル: [プレビュー表示]                          │
│                                                     │
│  開催時刻 *                                          │
│  ┌────────┐                                        │
│  │ 20:00  │                                        │
│  └────────┘                                        │
│                                                     │
│  ─── CTA設定 (オプション) ───                        │
│                                                     │
│  表示タイミング（開始から秒）                          │
│  ┌────────┐                                        │
│  │ 300    │                                        │
│  └────────┘                                        │
│                                                     │
│  ボタン文言                                          │
│  ┌─────────────────────────────────────────────┐   │
│  │ 今すぐ申し込む                               │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  リンク先URL                                         │
│  ┌─────────────────────────────────────────────┐   │
│  │ https://example.com/apply                   │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ─── その他設定 ───                                  │
│                                                     │
│  [ ] 再訪問ブロックを有効にする                        │
│                                                     │
│            [キャンセル]  [保存する]                    │
└─────────────────────────────────────────────────────┘
```

---

### Step 2-5: YouTube情報自動取得

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-5-1 | YouTube API Route | サーバーサイドでAPI呼び出し | src/app/api/youtube-info/route.ts |
| 2-5-2 | URLパース | YouTube URLからVideoID抽出 | src/lib/youtube/parser.ts |
| 2-5-3 | 自動取得UI | ボタン押下で情報取得 | - |
| 2-5-4 | 手動入力フォールバック | API失敗時の対応 | - |

#### YouTube API Route例
```typescript
// src/app/api/youtube-info/route.ts
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
  const { videoId } = await request.json();

  const apiKey = process.env.YOUTUBE_API_KEY;
  const url = `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&key=${apiKey}&part=snippet,contentDetails`;

  const response = await fetch(url);
  const data = await response.json();

  if (!data.items?.length) {
    return NextResponse.json({ error: 'Video not found' }, { status: 404 });
  }

  const video = data.items[0];
  const duration = parseDuration(video.contentDetails.duration); // ISO 8601 -> seconds

  return NextResponse.json({
    title: video.snippet.title,
    thumbnailUrl: video.snippet.thumbnails.high.url,
    durationSec: duration,
  });
}
```

---

### Step 2-6: 埋め込みコードコピー機能

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-6-1 | コード生成 | iFrameコード文字列生成 | src/lib/embed-code.ts |
| 2-6-2 | コピーUI | モーダル + コピーボタン | src/components/dashboard/EmbedCodeModal.tsx |
| 2-6-3 | クリップボードAPI | コピー実行 + フィードバック | - |

---

### Step 2-7: プレビュー機能

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-7-1 | プレビューリンク | 新規タブで視聴ページを開く | - |
| 2-7-2 | プレビューモード | 時刻に関係なくテスト再生 | クエリパラメータ ?preview=true |

---

### Step 2-8: 視聴ページFirestore連携

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 2-8-1 | データ取得 | Firestoreからウェビナー情報取得 | - |
| 2-8-2 | エラーハンドリング | 存在しないID対応 | 404ページ |
| 2-8-3 | キャッシュ戦略 | ISR設定（オプション） | - |

---

### Phase 2 完了チェックリスト

- [ ] ログイン・ログアウトが機能する
- [ ] ダッシュボードにウェビナー一覧が表示される
- [ ] ウェビナーを新規作成できる
- [ ] YouTube URLから情報が自動取得される
- [ ] ウェビナーを編集できる
- [ ] ウェビナーを削除できる
- [ ] 埋め込みコードをコピーできる
- [ ] プレビューで動作確認できる
- [ ] 視聴ページがFirestoreデータで動作する

---

## Phase 3: 埋め込み機能・CTA実装

### 目的
外部サイトへの埋め込みとCTA機能を実装する。

---

### Step 3-1: 埋め込みページ実装

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 3-1-1 | 埋め込みルート | /embed/[id] ページ作成 | src/app/embed/[id]/page.tsx |
| 3-1-2 | iFrame最適化 | 余白・スクロール制御 | - |
| 3-1-3 | レスポンシブ対応 | 16:9アスペクト比維持 | - |
| 3-1-4 | X-Frame-Options | 埋め込み許可設定 | next.config.js |

---

### Step 3-2: CTA表示機能

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 3-2-1 | CTAコンポーネント | 下部スライドインバナー | src/components/player/CTABanner.tsx |
| 3-2-2 | 表示タイミング制御 | 設定秒数後に表示 | src/hooks/useCTADisplay.ts |
| 3-2-3 | リンク動作 | 埋め込み時は新規タブ | target="_blank" |
| 3-2-4 | アニメーション | スライドインエフェクト | Tailwind CSS |

#### CTAコンポーネント例
```typescript
// src/components/player/CTABanner.tsx
'use client';

import { motion, AnimatePresence } from 'framer-motion';

interface CTABannerProps {
  visible: boolean;
  label: string;
  url: string;
  isEmbed?: boolean;
}

export function CTABanner({ visible, label, url, isEmbed }: CTABannerProps) {
  return (
    <AnimatePresence>
      {visible && (
        <motion.div
          initial={{ y: 100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: 100, opacity: 0 }}
          className="absolute bottom-4 left-4 right-4 z-30"
        >
          <a
            href={url}
            target={isEmbed ? '_blank' : '_self'}
            rel="noopener noreferrer"
            className="block w-full py-4 px-6 bg-gradient-to-r from-orange-500 to-red-500
                       text-white text-center text-lg font-bold rounded-lg
                       hover:from-orange-600 hover:to-red-600 transition-all
                       shadow-lg"
          >
            {label} →
          </a>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

---

### Step 3-3: 埋め込みテスト

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 3-3-1 | HTMLテストページ | ローカルでの埋め込み確認 | test/embed-test.html |
| 3-3-2 | WordPress確認 | WP環境での動作テスト | - |
| 3-3-3 | ドメイン制限 | embedAllowedDomains実装 | - |

---

### Phase 3 完了チェックリスト

- [ ] /embed/[id] でプレイヤーが表示される
- [ ] iFrameで正常に埋め込める
- [ ] CTAが設定タイミングで表示される
- [ ] CTAクリックで新規タブが開く
- [ ] WordPressに埋め込んで動作する
- [ ] レスポンシブ表示が正しい

---

## Phase 4: UI/UX磨き込み・テスト

### 目的
品質を高め、本番運用に耐えうる状態にする。

---

### Step 4-1: UI/UXブラッシュアップ

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 4-1-1 | ローディング状態 | スケルトン/スピナー表示 | - |
| 4-1-2 | エラー表示 | ユーザーフレンドリーなエラー画面 | - |
| 4-1-3 | トースト通知 | 操作完了フィードバック | - |
| 4-1-4 | フォームUX | バリデーションメッセージ改善 | - |

---

### Step 4-2: ブラウザ互換性テスト

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 4-2-1 | LINEブラウザ (iOS) | 実機テスト・修正 | テスト結果レポート |
| 4-2-2 | LINEブラウザ (Android) | 実機テスト・修正 | テスト結果レポート |
| 4-2-3 | Mobile Safari | テスト・修正 | - |
| 4-2-4 | Mobile Chrome | テスト・修正 | - |
| 4-2-5 | Desktop browsers | Chrome, Safari, Firefox, Edge | - |

---

### Step 4-3: パフォーマンス最適化

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 4-3-1 | Lighthouse監査 | スコア確認・改善 | - |
| 4-3-2 | 画像最適化 | next/image活用 | - |
| 4-3-3 | バンドルサイズ | 不要な依存関係削除 | - |

---

### Step 4-4: スーパー管理者機能

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 4-4-1 | 管理者ログイン | 専用URL /admin-login | src/app/(auth)/admin-login/page.tsx |
| 4-4-2 | テナント一覧 | 全テナント表示 | src/app/(dashboard)/admin/page.tsx |
| 4-4-3 | テナント登録 | 新規事業者追加 | src/app/(dashboard)/admin/tenants/new/page.tsx |
| 4-4-4 | ステータス変更 | active/suspended切替 | - |

---

### Phase 4 完了チェックリスト

- [ ] 全主要ブラウザで動作確認完了
- [ ] LINEブラウザで問題なく動作する
- [ ] Lighthouseスコア80以上
- [ ] スーパー管理者がテナントを管理できる
- [ ] エラー時の表示が適切

---

## Phase 5: 本番デプロイ・運用開始

### 目的
本番環境にデプロイし、運用を開始する。

---

### Step 5-1: 本番環境準備

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 5-1-1 | ドメイン設定 | カスタムドメイン設定（オプション） | - |
| 5-1-2 | 環境変数確認 | 本番用環境変数設定 | - |
| 5-1-3 | Firestore Rules | 本番ルールデプロイ | - |
| 5-1-4 | Firebase指標設定 | Sparkプラン上限確認 | - |

---

### Step 5-2: 初期データ作成

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 5-2-1 | 管理者アカウント作成 | スーパー管理者ユーザー | - |
| 5-2-2 | テストテナント作成 | 動作確認用テナント | - |
| 5-2-3 | サンプルウェビナー作成 | 動作確認用ウェビナー | - |

---

### Step 5-3: 最終確認・リリース

#### タスク一覧

| # | タスク | 詳細 | 成果物 |
|---|--------|------|--------|
| 5-3-1 | E2Eテスト | 全フロー通しテスト | - |
| 5-3-2 | 本番デプロイ | Vercel本番デプロイ | デプロイ済みURL |
| 5-3-3 | 動作確認 | 本番環境での最終確認 | - |
| 5-3-4 | ウェブサイト埋め込み | お客様サイトへの設置 | - |

---

### Phase 5 完了チェックリスト

- [ ] 本番URLでアクセス可能
- [ ] 管理者ログインできる
- [ ] ウェビナーを作成・設定できる
- [ ] 埋め込みコードが生成される
- [ ] ウェブサイトに埋め込んで動作する
- [ ] 指定時刻に擬似ライブ配信が開始される

---

## 全体タイムライン概要

```
Phase 0: 環境構築         ████░░░░░░░░░░░░░░░░  (Step 0-1 ~ 0-4)
Phase 1: コアエンジン     ░░░░████████░░░░░░░░  (Step 1-1 ~ 1-7)
Phase 2: 管理画面・DB     ░░░░░░░░░░░░████████  (Step 2-1 ~ 2-8)
Phase 3: 埋め込み・CTA    ░░░░░░░░░░░░░░░░████  (Step 3-1 ~ 3-3)
Phase 4: 磨き込み・テスト ░░░░░░░░░░░░░░░░░░██  (Step 4-1 ~ 4-4)
Phase 5: 本番デプロイ     ░░░░░░░░░░░░░░░░░░░█  (Step 5-1 ~ 5-3)
```

---

## 技術スタック最終確認

| カテゴリ | 技術 | 備考 |
|----------|------|------|
| Framework | Next.js 14+ (App Router) | TypeScript必須 |
| Styling | Tailwind CSS + shadcn/ui | - |
| Animation | Framer Motion | CTAアニメーション等 |
| Backend | Firebase (Auth, Firestore) | Sparkプランから開始 |
| Video | YouTube IFrame API | 限定公開動画使用 |
| Hosting | Vercel | GitHub連携 |
| DateTime | dayjs | JST固定処理 |

---

## 次のアクション

1. **Phase 0 Step 0-2 から開始**: Next.jsプロジェクトを作成
2. Firebase Consoleでプロジェクト作成
3. YouTube Data API キーを取得

開発を開始する準備ができましたら、お知らせください。
