# オートウェビナー配信プラットフォーム 要件定義書（詳細版）

| 項目 | 内容 |
|------|------|
| 文書ID | AW-REQ-20251205 |
| バージョン | 1.0 |
| 作成日 | 2025年12月5日 |
| 基準文書 | 基本設計書 AW-SPEC-20251130 v2.0 |
| ステータス | 初版 |

---

## 1. はじめに

### 1.1 文書の目的
本文書は、オートウェビナー配信プラットフォームの開発に必要な機能要件・非機能要件を詳細に定義し、開発チームと関係者間での共通理解を確立することを目的とする。

### 1.2 対象読者
- 開発チーム（フロントエンド、バックエンド、インフラ）
- プロジェクトマネージャー
- QAチーム
- ステークホルダー

### 1.3 用語定義

| 用語 | 定義 |
|------|------|
| オートウェビナー | 録画動画を擬似ライブ配信として配信する仕組み |
| テナント | 本システムを利用する事業者アカウント |
| CTA | Call To Action。視聴者に行動を促すボタン・リンク |
| 入場フロー | 動画再生前にユーザーインタラクションを必要とする画面遷移 |
| シーク同期 | サーバー時刻に基づいて動画の再生位置を自動調整する機能 |
| 擬似ライブ | 録画動画をあたかもライブ配信のように見せる配信形態 |

### 1.4 参照文書
- オートウェビナー配信プラットフォーム 基本設計書 v2.0 (AW-SPEC-20251130)

---

## 2. システム概要

### 2.1 システムの目的
録画された動画コンテンツを、設定されたスケジュール（毎日定刻）に基づいて「擬似ライブ配信」するSaaS型Webアプリケーションを構築する。

### 2.2 ビジネス目標

| ID | 目標 | 成功指標 |
|----|------|----------|
| BG-001 | 視聴者のライブ感認識 | 視聴者の80%以上がライブと認識 |
| BG-002 | 視聴完了率の向上 | 視聴完了率70%以上 |
| BG-003 | CTA誘導率の向上 | CTA クリック率5%以上 |
| BG-004 | 低コスト運用 | 月間固定費$50以下（初期段階） |

### 2.3 システムスコープ

#### 2.3.1 スコープ内
- マルチテナント管理機能
- 擬似ライブ動画配信機能
- LINE内ブラウザ完全対応
- 外部サイト埋め込み機能
- CTA表示・誘導機能
- テナント管理画面
- スーパー管理者画面

#### 2.3.2 スコープ外（将来検討）
- 動画ホスティング機能（YouTube利用のため）
- リアルタイムチャット機能
- 視聴者アンケート機能
- 詳細アナリティクス機能
- 決済機能

---

## 3. ユーザー要件

### 3.1 アクター定義

| アクターID | アクター名 | 説明 |
|------------|------------|------|
| ACT-001 | 視聴者 | ウェビナーを視聴するエンドユーザー |
| ACT-002 | テナント管理者 | 事業者として自社ウェビナーを管理する利用者 |
| ACT-003 | スーパー管理者 | システム全体を管理する開発者・運営者 |

### 3.2 ユーザーストーリー

#### 3.2.1 視聴者のユーザーストーリー

| ID | ユーザーストーリー | 優先度 |
|----|-------------------|--------|
| US-V001 | 視聴者として、配信開始前にカウントダウンを見たい。配信開始時刻がわかるから。 | 高 |
| US-V002 | 視聴者として、入場ボタンをタップして動画視聴を開始したい。ライブ感を感じるから。 | 高 |
| US-V003 | 視聴者として、途中参加でも現在の進行に同期された動画を見たい。リアルタイム感を保つため。 | 高 |
| US-V004 | 視聴者として、LINEアプリ内でストレスなく視聴したい。主要な流入経路だから。 | 高 |
| US-V005 | 視聴者として、動画中に表示されるCTAをクリックして詳細ページに移動したい。 | 高 |
| US-V006 | 視聴者として、配信終了後に終了画面または誘導ページを見たい。次のアクションがわかるから。 | 中 |

#### 3.2.2 テナント管理者のユーザーストーリー

| ID | ユーザーストーリー | 優先度 |
|----|-------------------|--------|
| US-T001 | テナント管理者として、ウェビナーを新規作成したい。配信を開始するため。 | 高 |
| US-T002 | テナント管理者として、YouTube URLから動画情報を自動取得したい。入力の手間を省くため。 | 中 |
| US-T003 | テナント管理者として、ウェビナーの開催時刻を設定したい。配信スケジュールを管理するため。 | 高 |
| US-T004 | テナント管理者として、CTAの表示タイミング・文言・リンク先を設定したい。コンバージョンを最適化するため。 | 高 |
| US-T005 | テナント管理者として、埋め込みコードをコピーしたい。外部サイトに設置するため。 | 高 |
| US-T006 | テナント管理者として、ウェビナーをプレビューしたい。公開前に確認するため。 | 中 |
| US-T007 | テナント管理者として、ウェビナーを削除したい。不要な配信を整理するため。 | 中 |
| US-T008 | テナント管理者として、再訪問ブロック機能を設定したい。希少性を演出するため。 | 低 |

#### 3.2.3 スーパー管理者のユーザーストーリー

| ID | ユーザーストーリー | 優先度 |
|----|-------------------|--------|
| US-S001 | スーパー管理者として、新規テナントを登録したい。新規顧客をオンボードするため。 | 高 |
| US-S002 | スーパー管理者として、テナントのステータスを変更したい。アカウント管理のため。 | 高 |
| US-S003 | スーパー管理者として、全テナント一覧を確認したい。運用状況を把握するため。 | 中 |

---

## 4. 機能要件

### 4.1 視聴者機能 (Player)

#### FR-P001: 状態遷移表示機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P001 |
| 要件名 | 配信状態遷移表示 |
| 優先度 | 必須 |
| 関連US | US-V001, US-V002 |

**詳細説明:**
システムはサーバー時刻に基づいて、以下の3つの状態を判定し適切な画面を表示する。

| 状態 | 条件 | 表示内容 |
|------|------|----------|
| BEFORE | 現在時刻 < 当日開催設定時刻 | カウントダウンタイマー + 待機メッセージ |
| ON_AIR | 開催設定時刻 <= 現在時刻 < (開催設定時刻 + 動画尺) | 入場ボタン → 動画プレイヤー |
| ENDED | 現在時刻 >= (開催設定時刻 + 動画尺) | 終了画面 or リダイレクト |

**受入条件:**
- [ ] サーバー時刻（Firebase ServerTimestamp または WorldTimeAPI）を取得できること
- [ ] 3つの状態が正しく判定されること
- [ ] 状態に応じた画面が表示されること
- [ ] クライアント時刻ではなくサーバー時刻を基準とすること

---

#### FR-P002: カウントダウンタイマー機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P002 |
| 要件名 | 開催前カウントダウン表示 |
| 優先度 | 必須 |
| 関連US | US-V001 |

**詳細説明:**
BEFORE状態において、開催時刻までの残り時間をリアルタイムでカウントダウン表示する。

**表示形式:**
```
開催まで あと 00:05:32
（時:分:秒形式）
```

**受入条件:**
- [ ] 残り時間が1秒単位で更新されること
- [ ] 0になった時点でON_AIR状態に遷移すること
- [ ] サムネイル画像またはぼかし背景と共に表示されること

---

#### FR-P003: 入場ボタン機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P003 |
| 要件名 | 入場ボタンによる動画開始 |
| 優先度 | 必須 |
| 関連US | US-V002, US-V004 |

**詳細説明:**
ON_AIR状態において、「会場に入場する」ボタンを画面中央に表示し、タップ時に動画再生を開始する。

**処理フロー:**
1. ボタンをタップ
2. YouTube Playerのミュート解除 (`player.unMute()`)
3. サーバー時刻に基づくシーク位置計算 (`現在時刻 - 開催時刻`)
4. 計算位置へシーク (`player.seekTo()`)
5. 動画再生開始 (`player.playVideo()`)
6. 入場オーバーレイを非表示

**受入条件:**
- [ ] ボタンにパルスアニメーションが適用されていること
- [ ] タップ後に音声付きで動画が再生されること
- [ ] 途中参加でも現在の進行位置から再生が始まること
- [ ] LINEブラウザ（iOS/Android）で正常動作すること
- [ ] iOS Safariで正常動作すること

---

#### FR-P004: シーク同期機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P004 |
| 要件名 | サーバー時刻同期再生 |
| 優先度 | 必須 |
| 関連US | US-V003 |

**詳細説明:**
動画の再生位置をサーバー時刻に基づいて計算し、全視聴者が同じ進行状況を視聴できるようにする。

**計算式:**
```
シーク位置(秒) = 現在時刻 - 開催設定時刻
```

**受入条件:**
- [ ] 入場時にシーク位置が正しく計算されること
- [ ] ページリロード時も同期位置から再生されること
- [ ] 許容誤差は±3秒以内とする

---

#### FR-P005: YouTube Player隠蔽機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P005 |
| 要件名 | YouTubeコントロール・リンク隠蔽 |
| 優先度 | 必須 |
| 関連US | - |

**詳細説明:**
YouTube IFrame上に透明なdiv要素を配置し、ユーザーによる操作を防止する。

**適用パラメータ:**
- `controls=0`: コントローラー非表示
- `modestbranding=1`: ロゴ控えめ
- `rel=0`: 関連動画抑制（同チャンネルのみ表示）
- `playsinline=1`: iOSインライン再生

**Click Block実装:**
- IFrame上に透明div配置
- `pointer-events: auto` 設定
- クリックイベントを吸収

**受入条件:**
- [ ] YouTubeコントロールが表示されないこと
- [ ] 動画クリックで一時停止されないこと
- [ ] YouTubeロゴ・タイトルクリックでYouTubeに遷移しないこと
- [ ] 動画終了1秒前に終了画面を被せて関連動画を隠すこと

---

#### FR-P006: CTA表示機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P006 |
| 要件名 | CTA(Call To Action)オーバーレイ表示 |
| 優先度 | 必須 |
| 関連US | US-V005 |

**詳細説明:**
設定されたタイミングで動画下部にCTAボタンをスライドインアニメーションで表示する。

**表示条件:**
- 動画再生開始から `ctaSettings.showTimeSec` 秒経過後

**表示内容:**
- ボタンラベル: `ctaSettings.label`
- リンク先: `ctaSettings.url`

**挙動:**
- 埋め込み時: `target="_blank"` で新規タブで開く
- スタンドアロン時: 同一タブで遷移

**受入条件:**
- [ ] 指定秒数後にCTAがアニメーション表示されること
- [ ] ボタンクリックで正しいURLに遷移すること
- [ ] 埋め込み時は新規タブで開くこと
- [ ] CTAが動画の視聴を妨げない位置に表示されること

---

#### FR-P007: 終了画面表示機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P007 |
| 要件名 | 配信終了画面表示 |
| 優先度 | 必須 |
| 関連US | US-V006 |

**詳細説明:**
ENDED状態において、終了メッセージまたは設定されたURLへのリダイレクトを行う。

**表示パターン:**
1. 終了メッセージ表示: 「本日の配信は終了しました」
2. リダイレクト: 設定URLへ自動遷移

**受入条件:**
- [ ] 動画終了1秒前に終了画面コンポーネントを表示すること
- [ ] YouTube関連動画が表示されないこと
- [ ] リダイレクト設定時は自動遷移すること

---

#### FR-P008: LIVEバッジ表示機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P008 |
| 要件名 | ライブ感演出バッジ表示 |
| 優先度 | 中 |
| 関連US | US-V002 |

**詳細説明:**
ON_AIR状態の動画再生中、画面左上に「● LIVE」バッジを表示する。

**デザイン:**
- 赤色点滅アニメーション
- 半透明背景

**受入条件:**
- [ ] ON_AIR状態でのみ表示されること
- [ ] 点滅アニメーションが動作すること

---

#### FR-P009: 埋め込み対応機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P009 |
| 要件名 | iFrame埋め込み対応 |
| 優先度 | 必須 |
| 関連US | US-T005 |

**詳細説明:**
外部サイト（WordPress、Shopify等）にiFrameで埋め込み可能なページを提供する。

**埋め込みURL形式:**
```
https://[APP_DOMAIN]/embed/[WEBINAR_ID]
```

**提供コード:**
```html
<div style="position:relative; padding-bottom:56.25%; height:0; overflow:hidden;">
  <iframe src="https://[APP_DOMAIN]/embed/[WEBINAR_ID]"
    style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;"
    allow="autoplay; fullscreen" allowfullscreen>
  </iframe>
</div>
```

**受入条件:**
- [ ] 16:9アスペクト比でレスポンシブ表示されること
- [ ] WordPressに埋め込んで正常動作すること
- [ ] Shopifyに埋め込んで正常動作すること
- [ ] 親サイトのスタイルに影響されないこと

---

#### FR-P010: 再訪問ブロック機能（オプション）

| 項目 | 内容 |
|------|------|
| 要件ID | FR-P010 |
| 要件名 | 再訪問ブロック |
| 優先度 | 低 |
| 関連US | US-T008 |

**詳細説明:**
`loopProtection`がONの場合、一度視聴したユーザーの再訪問をブロックする。

**実装方式:**
- LocalStorageに視聴済みフラグを保存
- 再訪問時は「本日の配信は終了しました」を表示

**受入条件:**
- [ ] ON設定時、再訪問がブロックされること
- [ ] OFF設定時、再訪問が可能なこと
- [ ] ブラウザのプライベートモードでリセットされることを許容

---

### 4.2 テナント管理者機能

#### FR-T001: テナントログイン機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T001 |
| 要件名 | メール/パスワード認証 |
| 優先度 | 必須 |
| 関連US | - |

**詳細説明:**
Firebase Authenticationを使用したメール/パスワード認証。

**受入条件:**
- [ ] 登録済みメールアドレスでログインできること
- [ ] 不正なメール/パスワードでログインできないこと
- [ ] パスワードリセット機能があること

---

#### FR-T002: ダッシュボード機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T002 |
| 要件名 | ウェビナー一覧表示 |
| 優先度 | 必須 |
| 関連US | US-T001 |

**詳細説明:**
ログイン後、自社が所有するウェビナーの一覧を表示する。

**表示項目:**
- ウェビナータイトル
- サムネイル
- 開催時刻
- ステータス（設定済み/未設定）

**操作ボタン:**
- 編集
- 削除
- 埋め込みコードコピー
- プレビュー

**受入条件:**
- [ ] 自社のウェビナーのみ表示されること
- [ ] 各操作ボタンが機能すること
- [ ] 新規作成ボタンがあること

---

#### FR-T003: ウェビナー新規作成機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T003 |
| 要件名 | ウェビナー新規作成 |
| 優先度 | 必須 |
| 関連US | US-T001 |

**詳細説明:**
新規ウェビナーを作成するフォームを提供する。

**入力項目:**

| フィールド | 必須 | 入力形式 | 説明 |
|------------|------|----------|------|
| タイトル | ○ | テキスト | ウェビナー名 |
| YouTube URL | ○ | URL | YouTube動画のURL |
| 開催時刻 | ○ | HH:mm | 毎日の配信開始時刻 |
| CTA表示タイミング | - | 数値(秒) | 開始からの秒数 |
| CTAボタン文言 | - | テキスト | ボタンのラベル |
| CTAリンク先 | - | URL | クリック時の遷移先 |
| 再訪問ブロック | - | ON/OFF | ブロック機能の有効/無効 |

**受入条件:**
- [ ] 必須項目未入力時にエラー表示されること
- [ ] 保存後、一覧に追加されること
- [ ] YouTube URLのバリデーションが行われること

---

#### FR-T004: YouTube情報自動取得機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T004 |
| 要件名 | YouTube動画メタデータ自動取得 |
| 優先度 | 中 |
| 関連US | US-T002 |

**詳細説明:**
YouTube URLを入力した際、YouTube Data API（またはoEmbed）を使用して以下を自動取得する。

**取得項目:**
- 動画タイトル
- サムネイルURL
- 動画の長さ（duration）

**受入条件:**
- [ ] URL入力後、自動取得ボタンで情報が取得されること
- [ ] 取得失敗時は手動入力が可能なこと
- [ ] APIキーがクライアントに露出しないこと

---

#### FR-T005: ウェビナー編集機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T005 |
| 要件名 | ウェビナー設定編集 |
| 優先度 | 必須 |
| 関連US | US-T003, US-T004 |

**詳細説明:**
既存ウェビナーの設定を編集する機能。

**受入条件:**
- [ ] 既存の設定値がフォームにプリセットされること
- [ ] 変更を保存できること
- [ ] キャンセルで変更を破棄できること

---

#### FR-T006: ウェビナー削除機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T006 |
| 要件名 | ウェビナー削除 |
| 優先度 | 必須 |
| 関連US | US-T007 |

**詳細説明:**
ウェビナーを削除する機能。

**受入条件:**
- [ ] 削除前に確認ダイアログが表示されること
- [ ] 削除後、一覧から消えること
- [ ] 削除されたウェビナーの埋め込みURLが無効化されること

---

#### FR-T007: 埋め込みコードコピー機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T007 |
| 要件名 | 埋め込みコードクリップボードコピー |
| 優先度 | 必須 |
| 関連US | US-T005 |

**詳細説明:**
ウェビナーの埋め込み用HTMLコードをクリップボードにコピーする機能。

**受入条件:**
- [ ] ワンクリックでコピーできること
- [ ] コピー完了のフィードバックが表示されること
- [ ] コードに正しいウェビナーIDが含まれること

---

#### FR-T008: プレビュー機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-T008 |
| 要件名 | ウェビナープレビュー |
| 優先度 | 中 |
| 関連US | US-T006 |

**詳細説明:**
公開前にウェビナーの表示を確認できるプレビュー機能。

**受入条件:**
- [ ] 新規タブでプレビューが開くこと
- [ ] 実際の視聴者画面と同じ表示であること

---

### 4.3 スーパー管理者機能

#### FR-S001: スーパー管理者ログイン機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-S001 |
| 要件名 | スーパー管理者認証 |
| 優先度 | 必須 |
| 関連US | - |

**詳細説明:**
開発者専用の管理画面へのログイン機能。

**受入条件:**
- [ ] 専用URLでアクセスできること
- [ ] テナント用URLではアクセスできないこと
- [ ] 認証後、スーパー管理者権限が付与されること

---

#### FR-S002: テナント一覧表示機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-S002 |
| 要件名 | 全テナント一覧表示 |
| 優先度 | 必須 |
| 関連US | US-S003 |

**詳細説明:**
登録されている全テナントの一覧を表示する。

**表示項目:**
- メールアドレス
- 事業者名
- ステータス
- 登録日

**受入条件:**
- [ ] 全テナントが表示されること
- [ ] ステータスでフィルタリングできること

---

#### FR-S003: テナント新規登録機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-S003 |
| 要件名 | 新規テナント登録 |
| 優先度 | 必須 |
| 関連US | US-S001 |

**詳細説明:**
新規事業者をテナントとして登録する機能。

**入力項目:**
- メールアドレス（ログインID）
- 初期パスワード
- 事業者名

**受入条件:**
- [ ] Firebase Authにユーザーが作成されること
- [ ] tenantsコレクションにドキュメントが作成されること
- [ ] 重複メールアドレスでエラーになること

---

#### FR-S004: テナントステータス変更機能

| 項目 | 内容 |
|------|------|
| 要件ID | FR-S004 |
| 要件名 | テナントステータス変更 |
| 優先度 | 必須 |
| 関連US | US-S002 |

**詳細説明:**
テナントのステータスを変更する機能。

**ステータス:**
- `active`: 有効
- `suspended`: 停止中

**受入条件:**
- [ ] ステータスを変更できること
- [ ] suspended時、テナントがログインできなくなること

---

## 5. データ要件

### 5.1 データモデル

#### 5.1.1 tenants コレクション（事業者アカウント）

| フィールド | 型 | 必須 | 説明 |
|------------|-----|------|------|
| uid | String (PK) | ○ | Firebase AuthのUIDと一致 |
| email | String | ○ | ログインメールアドレス |
| companyName | String | ○ | 事業者名 |
| status | String | ○ | active / suspended |
| createdAt | Timestamp | ○ | 作成日時 |

**インデックス:**
- email (unique)
- status

---

#### 5.1.2 webinars コレクション（ウェビナー設定）

| フィールド | 型 | 必須 | 説明 |
|------------|-----|------|------|
| id | String (PK) | ○ | 自動生成ID |
| tenantId | String | ○ | 所有者のUID |
| title | String | ○ | ウェビナータイトル |
| youtubeId | String | ○ | YouTube動画ID |
| durationSec | Number | ○ | 動画の長さ(秒) |
| scheduleTime | String | ○ | 開催時刻 (HH:mm形式) |
| ctaSettings | Map | - | CTA設定 |
| ├ showTimeSec | Number | - | CTA表示タイミング(秒) |
| ├ label | String | - | ボタンの文言 |
| └ url | String | - | リンク先URL |
| loopProtection | Boolean | ○ | 再訪問ブロックON/OFF |
| embedAllowedDomains | Array<String> | - | 埋め込み許可ドメイン |
| createdAt | Timestamp | ○ | 作成日時 |
| updatedAt | Timestamp | ○ | 更新日時 |

**インデックス:**
- tenantId

---

### 5.2 データバリデーション

| フィールド | バリデーションルール |
|------------|---------------------|
| email | RFC 5322準拠のメール形式 |
| youtubeId | 11文字の英数字・ハイフン・アンダースコア |
| scheduleTime | HH:mm形式 (00:00〜23:59) |
| durationSec | 正の整数 (1以上) |
| ctaSettings.showTimeSec | 0以上、durationSec未満 |
| ctaSettings.url | 有効なURL形式 |

---

## 6. 非機能要件

### 6.1 性能要件

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-P001 | ページ初期表示時間 | 3秒以内 |
| NFR-P002 | 入場ボタン応答時間 | 1秒以内 |
| NFR-P003 | シーク同期精度 | ±3秒以内 |
| NFR-P004 | 同時視聴者数 | 1000人（Firebaseプランに依存） |

---

### 6.2 可用性要件

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-A001 | サービス稼働率 | 99.5%以上 |
| NFR-A002 | Vercelダウン時の代替 | 手動切り替えで対応 |

---

### 6.3 セキュリティ要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-S001 | 通信の暗号化 | HTTPS必須 |
| NFR-S002 | 認証 | Firebase Authentication使用 |
| NFR-S003 | Firestore Rules | 適切なアクセス制御を実装 |
| NFR-S004 | APIキー保護 | YouTube APIキーはサーバーサイドで使用 |

**Firestore Rules:**
```
// webinars 読み取り
allow read: if true;  // 誰でも読める（視聴者用）

// webinars 書き込み
allow write: if request.auth.uid == resource.data.tenantId;  // 所有者のみ

// tenants
allow read, write: if request.auth.token.admin == true;  // スーパー管理者のみ
```

---

### 6.4 互換性要件

| ID | 要件 | 対象 |
|----|------|------|
| NFR-C001 | LINEアプリ内ブラウザ | iOS 14以上、Android 10以上 |
| NFR-C002 | Mobile Safari | iOS 14以上 |
| NFR-C003 | Mobile Chrome | Android 10以上 |
| NFR-C004 | Desktop Chrome | 最新2バージョン |
| NFR-C005 | Desktop Safari | 最新2バージョン |
| NFR-C006 | Desktop Firefox | 最新2バージョン |
| NFR-C007 | Desktop Edge | 最新2バージョン |

---

### 6.5 保守性要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-M001 | コードスタイル | ESLint + Prettier適用 |
| NFR-M002 | 型安全性 | TypeScript strict mode |
| NFR-M003 | テスト | ユニットテストカバレッジ60%以上 |

---

### 6.6 運用要件

| ID | 要件 | 詳細 |
|----|------|------|
| NFR-O001 | デプロイ | Vercel自動デプロイ（GitHub連携） |
| NFR-O002 | ログ | Vercel標準ログ + Firebase Functions ログ |
| NFR-O003 | エラー監視 | 将来的にSentry導入検討 |

---

## 7. 制約事項

### 7.1 技術的制約

| ID | 制約 | 理由 |
|----|------|------|
| CON-001 | YouTube限定公開動画を使用 | 動画ホスティングコスト削減のため |
| CON-002 | 収益化オフ必須 | 広告表示を防ぐため |
| CON-003 | ユーザーインタラクション必須 | LINEブラウザの自動再生制限のため |
| CON-004 | JST固定ロジック | 日本国内向けサービスのため |

### 7.2 ビジネス制約

| ID | 制約 | 理由 |
|----|------|------|
| CON-005 | Firebase Sparkプラン | 初期コスト抑制のため |
| CON-006 | Vercel Hobby/Pro Plan | 初期コスト抑制のため |

### 7.3 外部サービス依存

| サービス | 用途 | リスク |
|----------|------|--------|
| YouTube | 動画ホスティング | 利用規約変更、レート制限 |
| Firebase | 認証・DB | 料金体系変更、障害 |
| Vercel | ホスティング | 料金体系変更、障害 |

---

## 8. 画面一覧

| 画面ID | 画面名 | アクター | 説明 |
|--------|--------|----------|------|
| SCR-001 | 視聴ページ（BEFORE） | 視聴者 | カウントダウン表示 |
| SCR-002 | 視聴ページ（ON_AIR/入場前） | 視聴者 | 入場ボタン表示 |
| SCR-003 | 視聴ページ（ON_AIR/視聴中） | 視聴者 | 動画再生 + CTA |
| SCR-004 | 視聴ページ（ENDED） | 視聴者 | 終了画面 |
| SCR-005 | 埋め込みプレイヤー | 視聴者 | iFrame用視聴ページ |
| SCR-101 | テナントログイン | テナント管理者 | ログインフォーム |
| SCR-102 | ダッシュボード | テナント管理者 | ウェビナー一覧 |
| SCR-103 | ウェビナー新規作成 | テナント管理者 | 作成フォーム |
| SCR-104 | ウェビナー編集 | テナント管理者 | 編集フォーム |
| SCR-201 | スーパー管理者ログイン | スーパー管理者 | ログインフォーム |
| SCR-202 | テナント一覧 | スーパー管理者 | テナント管理画面 |
| SCR-203 | テナント登録 | スーパー管理者 | 登録フォーム |

---

## 9. API一覧

### 9.1 Next.js API Routes

| エンドポイント | メソッド | 説明 | 認証 |
|---------------|----------|------|------|
| /api/server-time | GET | サーバー時刻取得 | 不要 |
| /api/youtube-info | POST | YouTube動画情報取得 | 要（テナント） |

### 9.2 Firestore アクセス

| コレクション | 操作 | 説明 | 認証 |
|--------------|------|------|------|
| webinars | READ | ウェビナー情報取得（視聴者） | 不要 |
| webinars | WRITE | ウェビナーCRUD（テナント） | 要（所有者） |
| tenants | READ/WRITE | テナント管理（スーパー管理者） | 要（admin） |

---

## 10. 開発フェーズ

### Phase 1: コアエンジンの開発

| 項目 | 詳細 |
|------|------|
| 期間目安 | 1週間 |
| 成果物 | 視聴者機能プロトタイプ |

**タスク:**
- [ ] Next.jsプロジェクトセットアップ
- [ ] YouTube IFrame APIラッパーコンポーネント作成
- [ ] 状態遷移ロジック実装
- [ ] 入場ボタン → 同期再生のプロトタイプ完成
- [ ] LINEブラウザ対応

---

### Phase 2: 管理機能とDB連携

| 項目 | 詳細 |
|------|------|
| 期間目安 | 1週間 |
| 成果物 | 管理画面 + 埋め込み機能 |

**タスク:**
- [ ] Firebase Auth / Firestore構築
- [ ] テナント管理画面（CRUD）実装
- [ ] スーパー管理者画面実装
- [ ] 埋め込み用ページ (/embed/[id]) のルーティング実装

---

### Phase 3: UI磨き込みとテスト

| 項目 | 詳細 |
|------|------|
| 期間目安 | 1週間 |
| 成果物 | 本番リリース版 |

**タスク:**
- [ ] LINEブラウザでの実機テスト（最重要）
- [ ] CTAのアニメーション実装
- [ ] WordPressへの埋め込み表示確認
- [ ] 終了画面コンポーネント実装
- [ ] Vercelデプロイ・本番リリース

---

## 11. 受入テスト項目

### 11.1 視聴者機能テスト

| テストID | テスト項目 | 期待結果 |
|----------|-----------|----------|
| AT-001 | BEFORE状態でページアクセス | カウントダウンが表示される |
| AT-002 | ON_AIR状態でページアクセス | 入場ボタンが表示される |
| AT-003 | 入場ボタンタップ | 音声付きで動画が再生される |
| AT-004 | 途中参加時の再生位置 | 現在の進行状況に同期される |
| AT-005 | CTA表示 | 設定時刻に表示される |
| AT-006 | CTAクリック（埋め込み） | 新規タブで開く |
| AT-007 | 動画終了時 | 終了画面が表示される |
| AT-008 | LINEブラウザ（iOS） | 正常に再生される |
| AT-009 | LINEブラウザ（Android） | 正常に再生される |
| AT-010 | WordPress埋め込み | 正常に表示・動作する |

### 11.2 管理機能テスト

| テストID | テスト項目 | 期待結果 |
|----------|-----------|----------|
| AT-101 | テナントログイン | ダッシュボードが表示される |
| AT-102 | ウェビナー作成 | 一覧に追加される |
| AT-103 | ウェビナー編集 | 変更が保存される |
| AT-104 | ウェビナー削除 | 一覧から削除される |
| AT-105 | 埋め込みコードコピー | クリップボードにコピーされる |

---

## 12. 改訂履歴

| バージョン | 日付 | 変更者 | 変更内容 |
|------------|------|--------|----------|
| 1.0 | 2025-12-05 | - | 初版作成（基本設計書v2.0より詳細化） |

---

## 付録A: ワイヤーフレーム参照

### A.1 視聴ページ（Mobile/Embed共通）レイヤー構造

```
┌─────────────────────────────────────┐
│  [● LIVE]                           │ ← UI Layer (上部)
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │      YouTube Video          │   │ ← Video Layer
│  │                             │   │
│  │   (透明Blocker Layer)        │   │ ← Blocker Layer
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  📦 今すぐ申し込む →        │   │ ← CTA Area (アニメーション)
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### A.2 入場オーバーレイ

```
┌─────────────────────────────────────┐
│                                     │
│         開催まで あと              │
│           00:05:32                  │
│                                     │
│    ┌─────────────────────────┐     │
│    │                         │     │
│    │    (サムネイル + ぼかし)  │     │
│    │                         │     │
│    │  ┌───────────────────┐ │     │
│    │  │ 会場に入場する 🎬  │ │     │ ← パルスアニメーション
│    │  └───────────────────┘ │     │
│    │                         │     │
│    └─────────────────────────┘     │
│                                     │
└─────────────────────────────────────┘
```

---

## 付録B: 技術的注意事項

### B.1 YouTube関連動画対策
動画終了の1秒前に終了画面コンポーネントを動画上に被せることで、YouTube関連動画の表示を防止する。

### B.2 タイムゾーン処理
- すべての計算はJST（日本時間）固定で行う
- Day.jsを使用し、タイムゾーン変換エラーを防止
- サーバー時刻はFirebase ServerTimestampまたはWorldTimeAPIから取得

### B.3 LINEブラウザ対策
- 必ずユーザーインタラクション（タップ）を経由して動画再生を開始
- `playsinline=1` パラメータを必ず設定
- 音声は入場ボタンタップ後にミュート解除

---

*文書終わり*
